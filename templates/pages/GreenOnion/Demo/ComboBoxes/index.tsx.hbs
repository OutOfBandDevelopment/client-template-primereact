{{ import "_common/file_header.ts" }}

import React from 'react';
import { useForm, Controller } from 'react-hook-form';
import { Panel } from 'primereact/panel';
import { Button } from 'primereact/button';

import {
{{#each paths as |request uri| ~}}
  {{~ #each request as |body httpMehtod| ~}}
    {{~ #if body.x-query-set~}}
        {{~ #if-any body.x-query-action "query"~}}
            {{~ #each @root.components.schemas as |entityDefinition entityName|~}}
                {{~ #if-any entityName body.x-query-set}}
                    {{~ #unless entityDefinition.x-not-selectable}}
  {{str-element entityName "." "@last"}}ComboBox,
                    {{~/unless}}
                {{/if-any~}}
            {{~/each~}}
        {{/if-any~}}
    {{~/if~}}
  {{~/each~}}
{{~/each}}
} from '@/components/{{@namespace}}';

import type {
{{#each paths as |request uri| ~}}
  {{~ #each request as |body httpMehtod| ~}}
    {{~ #if body.x-query-set~}}
        {{~ #if-any body.x-query-action "query"~}}
            {{~ #each @root.components.schemas as |entityDefinition entityName|~}}
                {{~ #if-any entityName body.x-query-set}}
                    {{~ #unless entityDefinition.x-not-selectable}}
  {{concat "I" (str-element entityName "." "@last")}},
                    {{~/unless}}
                {{/if-any~}}
            {{~/each~}}
        {{/if-any~}}
    {{~/if~}}
  {{~/each~}}
{{~/each}}
} from '@/components/{{@namespace}}';

import './index.scss';

/**
 * Form data interface for all dropdowns with entity binding support
 */
interface DemoFormData {
{{#each paths as |request uri| ~}}
  {{~ #each request as |body httpMehtod| ~}}
    {{~ #if body.x-query-set~}}
        {{~ #if-any body.x-query-action "query"~}}
            {{~ #each @root.components.schemas as |entityDefinition entityName|~}}
                {{~ #if-any entityName body.x-query-set}}
                    {{~ #unless entityDefinition.x-not-selectable}}
  {{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}}: number;
  {{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}}Entity: {{concat "I" (str-element entityName "." "@last")}} | undefined;
  {{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}}Text: string;
                    {{~/unless}}
                {{/if-any~}}
            {{~/each~}}
        {{/if-any~}}
    {{~/if~}}
  {{~/each~}}
{{~/each}}
}

/**
 * Demo UI page to showcase all dropdown components
 * Displays each dropdown with form integration and real-time value display
 */
export default function DemoComboBoxes() {
  const { handleSubmit, watch, setValue, reset, control, formState: { errors } } = useForm<DemoFormData>({
    defaultValues: {
{{#each paths as |request uri| ~}}
  {{~ #each request as |body httpMehtod| ~}}
    {{~ #if body.x-query-set~}}
        {{~ #if-any body.x-query-action "query"~}}
            {{~ #each @root.components.schemas as |entityDefinition entityName|~}}
                {{~ #if-any entityName body.x-query-set}}
                    {{~ #unless entityDefinition.x-not-selectable}}
      {{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}}: 0,
      {{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}}Entity: undefined,
      {{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}}Text: '',
                    {{~/unless}}
                {{/if-any~}}
            {{~/each~}}
        {{/if-any~}}
    {{~/if~}}
  {{~/each~}}
{{~/each}}
    }
  });

  const watchedValues = watch();

  const onSubmit = (data: DemoFormData) => {
    console.log('Form submitted with data:', data);
    alert('Form submitted! Check console for data.');
  };

  return (
    <div className="demo-ui-page p-4">
      <h1 className="text-2xl font-bold mb-4">ComboBox Components Demo</h1>
      <p className="text-gray-600 mb-6">Showcase of all standardized dropdown components with form integration</p>

      <form onSubmit={handleSubmit(onSubmit)}>
        {/* Current Form Values Display */}
        <Panel header="Current Form Values" className="mb-4" toggleable>
          <pre className="text-sm bg-gray-100 p-3 rounded overflow-auto max-h-64">
            {JSON.stringify(watchedValues, null, 2)}
          </pre>
        </Panel>

        {/* ComboBox Grid */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
{{#each paths as |request uri| ~}}
  {{~ #each request as |body httpMehtod| ~}}
    {{~ #if body.x-query-set~}}
        {{~ #if-any body.x-query-action "query"~}}
            {{~ #each @root.components.schemas as |entityDefinition entityName|~}}
                {{~ #if-any entityName body.x-query-set}}
                    {{~ #unless entityDefinition.x-not-selectable}}
          {/* {{import template="_common/get-entity-name" body=body}} */}
          <Panel header="{{import template="_common/get-entity-name" body=body}}">
            <div className="flex flex-col gap-2">
              <label htmlFor="{{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}}">
                {{import template="_common/get-entity-name" body=body}}
              </label>
              <{{str-element entityName "." "@last"}}ComboBox<DemoFormData>
                control={control}
                setValue={setValue}
                name="{{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}}"
                entityName="{{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}}Entity"
                textName="{{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}}Text"
                placeholder="Select {{import template="_common/get-entity-name" body=body}}..."
                required={false}
              />
              {errors.{{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}} && (
                <small className="p-error">
                  {errors.{{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}}?.message}
                </small>
              )}
              <div className="text-xs text-gray-500 mt-1">
                <div>ID: {watchedValues.{{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}} || 'None'}</div>
                <div>Text: {watchedValues.{{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}}Text || 'None'}</div>
              </div>
            </div>
          </Panel>
                    {{~/unless}}
                {{/if-any~}}
            {{~/each~}}
        {{/if-any~}}
    {{~/if~}}
  {{~/each~}}
{{~/each}}
        </div>

        {/* Hidden Controllers for Entity and Text Fields */}
        <div style={ { display: 'none' } }>
{{#each paths as |request uri| ~}}
  {{~ #each request as |body httpMehtod| ~}}
    {{~ #if body.x-query-set~}}
        {{~ #if-any body.x-query-action "query"~}}  
            {{~ #each @root.components.schemas as |entityDefinition entityName|~}}
                {{~ #if-any entityName body.x-query-set}}
          <Controller
            name="{{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}}Entity"
            control={control}
            render={({ field }) => <input {...field} value={field.value ? JSON.stringify(field.value) : ''} onChange={() => {}} />}
          />
          <Controller
            name="{{import template="_common/get-entity-property" def=entityDefinition targetProperty="x-navigation-key"}}Text"
            control={control}
            render={({ field }) => <input {...field} value={field.value || ''} onChange={() => {}} />}
          />
                {{/if-any~}}
            {{~/each~}}
        {{/if-any~}}
    {{~/if~}}
  {{~/each~}}
{{~/each}}
        </div>

        {/* Form Actions */}
        <div className="flex gap-2 mt-4">
          <Button type="submit" label="Submit Form" className="p-button-success" />
          <Button type="button" label="Reset Form" className="p-button-secondary" onClick={() => reset()} />
        </div>
      </form>

      {/* Demo Features Info */}
      <Panel header="Demo Features" className="mt-4" toggleable collapsed>
        <ul className="list-disc pl-5 space-y-1">
          <li><strong>Form Integration:</strong> React Hook Form with Controller pattern</li>
          <li><strong>Real-time Updates:</strong> Values update immediately on selection</li>
          <li><strong>Entity Binding:</strong> Full entity object available via entityName prop</li>
          <li><strong>Text Binding:</strong> Display text available via textName prop</li>
          <li><strong>TypeScript Support:</strong> Full type safety throughout</li>
          <li><strong>Caching:</strong> API responses cached for 30 minutes</li>
        </ul>
      </Panel>
    </div>
  );
}